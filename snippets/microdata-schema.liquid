{%- comment -%}
This snippet structures the micro-data using JSON-LD specification. Starting from Impact 6, we are using
the structured_data built-in filter to ensure that Shopify can keep it up to date without requiring theme upgrade. If
you believe some information for products are missing, please reach Shopify support directly, as it is no longer
managed at the theme level.
{%- endcomment -%}

{%- if request.page_type == 'product' -%}
  <script type="application/ld+json">
    {{- product | structured_data -}}
  </script>
{%- elsif request.page_type == 'article' -%}
  <script type="application/ld+json">
    {{- article | structured_data -}}
  </script>
  {%- comment -%}Explicit Article schema per Google's structured data guidelines{%- endcomment -%}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Article",
    "headline": {{ article.title | json }},
    {%- if article.excerpt_or_content != blank -%}
    "description": {{ article.excerpt_or_content | strip_html | truncate: 160 | json }},
    {%- endif -%}
    {%- if article.image -%}
    "image": {
      "@type": "ImageObject",
      "url": {{ article.image | image_url: width: 1200 | prepend: 'https:' | json }},
      "width": 1200,
      "height": {{ 1200 | divided_by: article.image.aspect_ratio | round }}
    },
    {%- endif -%}
    "datePublished": {{ article.published_at | date: '%Y-%m-%dT%H:%M:%S%z' | json }},
    "dateModified": {{ article.updated_at | default: article.published_at | date: '%Y-%m-%dT%H:%M:%S%z' | json }},
    "author": {
      "@type": "Person",
      "name": {{ article.author | json }}
    },
    "publisher": {
      "@type": "Organization",
      "name": {{ shop.name | json }},
      "logo": {
        "@type": "ImageObject",
        "url": {%- if shop.brand.logo -%}{{ shop.brand.logo | image_url: width: 600 | prepend: 'https:' | json }}{%- else -%}{{ settings.share_image | image_url: width: 600 | prepend: 'https:' | json }}{%- endif -%}
      }
    },
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": {{ request.origin | append: article.url | json }}
    }
  }
  </script>
{%- endif -%}

{%- comment -%}Organization markup on all pages. Logo: brand logo, share_image, or favicon. Social: theme social URL settings (same as footer).{%- endcomment -%}
{%- assign org_logo = nil -%}
{%- if shop.brand.logo -%}
  {%- assign org_logo = shop.brand.logo | image_url: width: shop.brand.logo.width | prepend: 'https:' -%}
{%- elsif settings.favicon -%}
  {%- assign org_logo = settings.favicon | image_url: width: 512 | prepend: 'https:' -%}
{%- endif -%}
{%- capture org_same_as -%}
  {%- assign first = true -%}
  {%- if settings.social_facebook != blank -%}{% unless first %},{% endunless %}{{ settings.social_facebook | json }}{% assign first = false -%}{%- endif -%}
  {%- if settings.social_twitter != blank -%}{% unless first %},{% endunless %}{{ settings.social_twitter | json }}{% assign first = false -%}{%- endif -%}
  {%- if settings.social_instagram != blank -%}{% unless first %},{% endunless %}{{ settings.social_instagram | json }}{% assign first = false -%}{%- endif -%}
  {%- if settings.social_threads != blank -%}{% unless first %},{% endunless %}{{ settings.social_threads | json }}{% assign first = false -%}{%- endif -%}
  {%- if settings.social_pinterest != blank -%}{% unless first %},{% endunless %}{{ settings.social_pinterest | json }}{% assign first = false -%}{%- endif -%}
  {%- if settings.social_youtube != blank -%}{% unless first %},{% endunless %}{{ settings.social_youtube | json }}{% assign first = false -%}{%- endif -%}
  {%- if settings.social_tiktok != blank -%}{% unless first %},{% endunless %}{{ settings.social_tiktok | json }}{% assign first = false -%}{%- endif -%}
  {%- if settings.social_vimeo != blank -%}{% unless first %},{% endunless %}{{ settings.social_vimeo | json }}{% assign first = false -%}{%- endif -%}
  {%- if settings.social_linkedin != blank -%}{% unless first %},{% endunless %}{{ settings.social_linkedin | json }}{% assign first = false -%}{%- endif -%}
  {%- if settings.social_snapchat != blank -%}{% unless first %},{% endunless %}{{ settings.social_snapchat | json }}{% assign first = false -%}{%- endif -%}
  {%- if settings.social_whatsapp != blank -%}{% unless first %},{% endunless %}{{ settings.social_whatsapp | json }}{% assign first = false -%}{%- endif -%}
  {%- if settings.social_tumblr != blank -%}{% unless first %},{% endunless %}{{ settings.social_tumblr | json }}{% assign first = false -%}{%- endif -%}
  {%- if settings.social_wechat != blank -%}{% unless first %},{% endunless %}{{ settings.social_wechat | json }}{% assign first = false -%}{%- endif -%}
  {%- if settings.social_reddit != blank -%}{% unless first %},{% endunless %}{{ settings.social_reddit | json }}{% assign first = false -%}{%- endif -%}
  {%- if settings.social_line != blank -%}{% unless first %},{% endunless %}{{ settings.social_line | json }}{% assign first = false -%}{%- endif -%}
  {%- if settings.social_spotify != blank -%}{% unless first %},{% endunless %}{{ settings.social_spotify | json }}{% assign first = false -%}{%- endif -%}
{%- endcapture -%}
<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": {{ shop.name | json }},
    "url": {{ shop.url | json }}
    {%- if org_logo != blank -%},
    "logo": {{ org_logo | json }}
    {%- endif -%}
    {%- if shop.brand.short_description != blank -%},
    "description": {{ shop.brand.short_description | json }}
    {%- endif -%}
    {%- if shop.brand.slogan != blank -%},
    "slogan": {{ shop.brand.slogan | json }}
    {%- endif -%}
    {%- if org_same_as != blank -%},
    "sameAs": [{{ org_same_as | strip }}]
    {%- endif -%}
    {%- if shop.email != blank -%},
    "email": {{ shop.email | json }}
    {%- endif -%}
    {%- if shop.phone != blank -%},
    "telephone": {{ shop.phone | json }}
    {%- endif -%}
    {%- assign addr = shop.address -%}
    {%- if addr.address1 != blank and addr.address2 != blank -%}
      {%- assign street_address = addr.address1 | append: ', ' | append: addr.address2 -%}
    {%- elsif addr.address1 != blank -%}
      {%- assign street_address = addr.address1 -%}
    {%- elsif addr.address2 != blank -%}
      {%- assign street_address = addr.address2 -%}
    {%- else -%}
      {%- assign street_address = '' -%}
    {%- endif -%}
    {%- if street_address != blank or addr.city != blank or addr.province != blank or addr.zip != blank or addr.country_code != blank -%},
    "address": {
      "@type": "PostalAddress"
      {%- if street_address != blank -%},
      "streetAddress": {{ street_address | json }}
      {%- endif -%}
      {%- if addr.city != blank -%},
      "addressLocality": {{ addr.city | json }}
      {%- endif -%}
      {%- if addr.province != blank or addr.province_code != blank -%},
      "addressRegion": {{ addr.province | default: addr.province_code | json }}
      {%- endif -%}
      {%- if addr.zip != blank -%},
      "postalCode": {{ addr.zip | json }}
      {%- endif -%}
      {%- if addr.country_code != blank -%},
      "addressCountry": {{ addr.country_code | json }}
      {%- endif -%}
    }
    {%- endif -%}
  }
  </script>
<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "name": {{ 'general.home' | t | json }},
        "item": "{{ shop.url }}"
      }

      {%- if request.page_type == 'product' -%}
        {%- if collection -%}
          ,{
            "@type": "ListItem",
            "position": 2,
            "name": {{ collection.title | json }},
            "item": "{{ shop.url }}{{ collection.url }}"
          }, {
            "@type": "ListItem",
            "position": 3,
            "name": {{ product.title | json }},
            "item": "{{ shop.url }}{{ product.url }}"
          }
        {%- else -%}
          ,{
            "@type": "ListItem",
            "position": 2,
            "name": {{ product.title | json }},
            "item": "{{ shop.url }}{{ product.url }}"
          }
        {%- endif -%}
      {%- elsif request.page_type == 'collection' -%}
          ,{
            "@type": "ListItem",
            "position": 2,
            "name": {{ collection.title | json }},
            "item": "{{ shop.url }}{{ collection.url }}"
          }
      {%- elsif request.page_type == 'blog' -%}
          ,{
            "@type": "ListItem",
            "position": 2,
            "name": {{ blog.title | json }},
            "item": "{{ shop.url }}{{ blog.url }}"
          }
      {%- elsif request.page_type == 'article' -%}
          ,{
            "@type": "ListItem",
            "position": 2,
            "name": {{ blog.title | json }},
            "item": "{{ shop.url }}{{ blog.url }}"
          }, {
            "@type": "ListItem",
            "position": 3,
            "name": {{ article.title | json }},
            "item": "{{ shop.url }}{{ article.url }}"
          }
      {%- elsif request.page_type == 'page' -%}
        ,{
            "@type": "ListItem",
            "position": 2,
            "name": {{ page.title | json }},
            "item": "{{ shop.url }}{{ page.url }}"
          }
      {%- endif -%}
    ]
  }
</script>

{%- if request.page_type == 'index' -%}
  {%- assign potential_action_target = request.origin | append: routes.search_url | append: "?q={search_term_string}" -%}

  <script type="application/ld+json">
  [
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": {{ shop.name | json }},
      "url": {{ shop.url | append: page.url | json }},
      "potentialAction": {
        "@type": "SearchAction",
        "target": {{ potential_action_target | json }},
        "query-input": "required name=search_term_string"
      }
    },
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": {{ shop.name | json }},
      {%- if shop.brand.logo -%}
        "logo": {{ shop.brand.logo | image_url: width: shop.brand.logo.width | prepend: "https:" | json }},
      {%- endif -%}
      {%- if shop.brand.short_description -%}
        "description": {{ shop.brand.short_description | json }},
      {%- endif -%}
      {%- if shop.brand.slogan -%}
        "slogan": {{ shop.brand.slogan | json }},
      {%- endif -%}
      {%- if shop.brand.metafields.social_links.size > 0 -%}
        "sameAs": [
          {%- for social_link in shop.brand.metafields.social_links -%}
            {{- social_link.last.value | json -}}{%- unless forloop.last -%},{%- endunless -%}
          {%- endfor -%}
        ],
      {%- endif -%}
      "url": {{ shop.url | append: page.url | json }}
    }
  ]
  </script>
{%- endif -%}